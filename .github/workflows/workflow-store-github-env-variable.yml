name: Store GitHub Environment Variable

on:
  workflow_call:
    inputs:
      variable_name:
        required: true
        type: string
        description: "Name of the variable to store"
      variable_value:
        required: true
        type: string
        description: "Value to store in the variable"
      environment:
        required: true
        type: string
        description: "GitHub environment to store the variable in"
    secrets:
      GH_TOKEN:
        required: true
        description: "GitHub token with permission to set variables"

permissions:
  contents: read

jobs:
  store-variable:
    name: Store GitHub Environment Variable
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

      - name: Set GitHub variable
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          VARIABLE_NAME: ${{ inputs.variable_name }}
          VARIABLE_VALUE: ${{ inputs.variable_value }}
          ENVIRONMENT: ${{ inputs.environment }}
          REPOSITORY: ${{ github.repository }}
        run: |
          gh variable set "${VARIABLE_NAME}" \
            --body "${VARIABLE_VALUE}" \
            --env "${ENVIRONMENT}" \
            --repo "${REPOSITORY}"
