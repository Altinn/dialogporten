# SO SDK

Simple overview
Refit-based client SDK Based on https://github.com/altinn/altinn-apiclient-maskinporten

The refit-Interface is autogenerated with refitter. It uses OperationId to create method names.
Uses refit IApiResponse on returns.

## Installation

Install nuget

## Usage

This library provides extensions methods providing means to create dialogporten clients.

Setup

```C#
var configuration = new ConfigurationBuilder()
    .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true)
    .Build();

var services = new ServiceCollection();

services.AddSingleton<IConfiguration>(configuration);

services.AddDialogportenClient();
services.AddDialogTokenVerifer();
var dialogportenClient = serviceProvider.GetRequiredService<IServiceownerApi>();
```

AppSettings

```JSON
{
  "DialogportenSettings": {
    "Environment": "",
    "Maskinporten": {
      "ClientId": "",
      "Scope": "",
      "EncodedJwk": ""
    }
  },
  "Ed25519Keys": {
    "Primary": {
      "Kid": "",
      "PublicComponent": ""
    },
    "Secondary": {
      "Kid": "",
      "PublicComponent": ""
    }
  }
} 
```

Basic usage

```C#
// Basic Usage example

// Create a dialog
var createDialogCommand = new V1ServiceOwnerDialogsCommandsCreate_DialogCommand
{
    // createDialogCommand.Id = Guid.Parse("01927a6d-40d8-728b-b3da-845b680840d9");
    ServiceResource = "urn:altinn:resource:super-simple-service",
    Party = "urn:altinn:person:identifier-no:14886498226",
    SystemLabel = DialogEndUserContextsEntities_SystemLabel.Default,
    Status = DialogsEntities_DialogStatus.New,
    Progress = 2,
    Content = new V1ServiceOwnerDialogsCommandsCreate_Content
    {
        Title = new V1CommonContent_ContentValue
        {
            Value =
            [
                new V1CommonLocalizations_Localization
                {
                    LanguageCode = "nb",
                    Value = "Hoved"
                },
                new V1CommonLocalizations_Localization
                {
                    LanguageCode = "en",
                    Value = "Main"
                }
            ],
            MediaType = "text/plain"
        },
        Summary = new V1CommonContent_ContentValue
        {
            Value =
            [
                new V1CommonLocalizations_Localization
                {
                    LanguageCode = "nb",
                    Value = "Hoved Summary"
                },
                new V1CommonLocalizations_Localization
                {
                    LanguageCode = "en",
                    Value = "Main Summary"
                }
            ],
            MediaType = "text/plain"
        }


    },
    Transmissions =
    [
        new V1ServiceOwnerDialogsCommandsCreate_Transmission
        {
            Attachments =
            [
                new V1ServiceOwnerDialogsCommandsCreate_TransmissionAttachment
                {
                    DisplayName =
                    [
                        new V1CommonLocalizations_Localization
                        {
                            LanguageCode = "nb",
                            Value = "Hoved misson"
                        }
                    ],
                    Urls =
                    [
                        new V1ServiceOwnerDialogsCommandsCreate_TransmissionAttachmentUrl
                        {
                            ConsumerType = Attachments_AttachmentUrlConsumerType.Gui,
                            Url = new Uri("https://digdir.apps.tt02.altinn.no/some-other-url")
                        }
                    ]

                }
            ],
            Content = new V1ServiceOwnerDialogsCommandsCreate_TransmissionContent
            {
                Summary = new V1CommonContent_ContentValue
                {
                    MediaType = "text/plain",
                    Value =
                    [
                        new V1CommonLocalizations_Localization
                        {
                            LanguageCode = "nb",
                            Value = "Tranmission summary"
                        }
                    ]
                },
                Title = new V1CommonContent_ContentValue
                {
                    MediaType = "text/plain",
                    Value =
                    [
                        new V1CommonLocalizations_Localization
                        {
                            LanguageCode = "nb",
                            Value = "Tranmission Title"
                        }
                    ]
                }
            },
            Sender = new V1ServiceOwnerCommonActors_Actor
            {
                ActorType = Actors_ActorType.ServiceOwner
            },
            Type = DialogsEntitiesTransmissions_DialogTransmissionType.Information
        }
    ]
};
var response = await dialogportenClient.DialogsPost(createDialogCommand);
if (response.IsSuccessStatusCode)
{
    Console.WriteLine(response.StatusCode);
    string guid = response.Content; 
}
```

```C#
// Patch Dialog
List<JsonPatchOperations_Operation> patchDocument =
[
    new()
    {
        Op = "replace",
        OperationType = JsonPatchOperations_OperationType.Replace,
        Path = "/progress",
        Value = 50
    }
];
var patchResponse = await dialogportenClient.V1ServiceOwnerDialogsPatchDialog(guid, patchDocument, null);
Console.WriteLine(patchResponse.IsSuccessStatusCode);
Console.WriteLine(patchResponse.StatusCode);
```

DialogToken verification

```C#
var verifier = serviceProvider.GetRequiredService<DialogTokenVerifier>();
var token = ""; // Dialog token
Console.WriteLine(verifier.Verify(token));
var dict = DialogTokenVerifier.GetDialogTokenClaims(token);
```

API REFERENCE/STRUCTURE

Method name matches with the operationId in the OpenAPI spec

Links to changelog etc.
